<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ML Dashboard - PokerSim</title>
    <link rel="stylesheet" href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">PokerSim</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/about">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/examples">Examples</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/ml_dashboard">ML Dashboard</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        <h1 class="mb-4">Machine Learning Dashboard</h1>
        
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5>Start Training</h5>
                    </div>
                    <div class="card-body">
                        <form id="trainingForm">
                            <div class="mb-3">
                                <label for="algorithm" class="form-label">Algorithm</label>
                                <select class="form-select" id="algorithm">
                                    <option value="deep_cfr">Deep CFR</option>
                                    <option value="ppo">PPO</option>
                                    <option value="mcts">MCTS</option>
                                    <option value="cfr">CFR</option>
                                    <option value="nfsp">NFSP</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label for="iterations" class="form-label">Iterations</label>
                                <input type="number" class="form-control" id="iterations" min="100" max="10000" value="1000">
                            </div>
                            
                            <div class="mb-3">
                                <label for="batchSize" class="form-label">Batch Size</label>
                                <input type="number" class="form-control" id="batchSize" min="32" max="512" value="128">
                            </div>
                            
                            <div class="mb-3">
                                <label for="learningRate" class="form-label">Learning Rate</label>
                                <select class="form-select" id="learningRate">
                                    <option value="0.01">0.01</option>
                                    <option value="0.001" selected>0.001</option>
                                    <option value="0.0001">0.0001</option>
                                </select>
                            </div>
                            
                            <div class="mb-3 form-check">
                                <input type="checkbox" class="form-check-input" id="useGPU" checked>
                                <label class="form-check-label" for="useGPU">Use GPU Acceleration</label>
                            </div>
                            
                            <div class="mb-3 form-check">
                                <input type="checkbox" class="form-check-input" id="distributed">
                                <label class="form-check-label" for="distributed">Distributed Training</label>
                            </div>
                            
                            <div class="mb-3" id="workersGroup" style="display: none;">
                                <label for="numWorkers" class="form-label">Number of Workers</label>
                                <input type="number" class="form-control" id="numWorkers" min="2" max="8" value="2">
                            </div>
                            
                            <button type="submit" class="btn btn-primary">Start Training</button>
                        </form>
                    </div>
                </div>
            </div>
            
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5>Training Progress</h5>
                    </div>
                    <div class="card-body">
                        <div id="trainingStatus" class="alert alert-secondary">
                            No active training session
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Progress</label>
                            <div class="progress">
                                <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                            </div>
                            <div class="d-flex justify-content-between mt-1">
                                <small>0%</small>
                                <small id="progressPercent">0%</small>
                                <small>100%</small>
                            </div>
                        </div>
                        
                        <div class="training-stats d-none" id="trainingStats">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Statistics</h6>
                                    <table class="table table-sm">
                                        <tbody>
                                            <tr>
                                                <td>Algorithm</td>
                                                <td id="stat-algorithm"></td>
                                            </tr>
                                            <tr>
                                                <td>Current Iteration</td>
                                                <td id="stat-iteration"></td>
                                            </tr>
                                            <tr>
                                                <td>Loss</td>
                                                <td id="stat-loss"></td>
                                            </tr>
                                            <tr>
                                                <td>Elapsed Time</td>
                                                <td id="stat-time"></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="col-md-6">
                                    <h6>Hardware</h6>
                                    <table class="table table-sm">
                                        <tbody>
                                            <tr>
                                                <td>Framework</td>
                                                <td id="stat-framework"></td>
                                            </tr>
                                            <tr>
                                                <td>Device</td>
                                                <td id="stat-device"></td>
                                            </tr>
                                            <tr>
                                                <td>Memory Usage</td>
                                                <td id="stat-memory"></td>
                                            </tr>
                                            <tr>
                                                <td>Workers</td>
                                                <td id="stat-workers"></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card mt-4">
                    <div class="card-header">
                        <h5>Learning Curves</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="learningCurveChart" height="250"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5>Saved Models</h5>
                        <button class="btn btn-sm btn-outline-primary" id="refreshModels">Refresh</button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Algorithm</th>
                                        <th>Framework</th>
                                        <th>Iterations</th>
                                        <th>Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="modelsTableBody">
                                    <!-- This will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        <div id="noModelsMessage" class="alert alert-secondary">
                            No saved models found
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Model Evaluation Modal -->
        <div class="modal fade" id="evaluateModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Evaluate Model</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="evaluationForm">
                            <div class="mb-3">
                                <label for="evalOpponent" class="form-label">Opponent Type</label>
                                <select class="form-select" id="evalOpponent">
                                    <option value="random">Random Agent</option>
                                    <option value="call">Call Agent</option>
                                    <option value="rule_based">Rule-Based Agent</option>
                                    <option value="advanced">Advanced Agent</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label for="evalGames" class="form-label">Number of Games</label>
                                <input type="number" class="form-control" id="evalGames" min="100" max="10000" value="1000">
                            </div>
                            
                            <div class="mb-3 form-check">
                                <input type="checkbox" class="form-check-input" id="detailedResults">
                                <label class="form-check-label" for="detailedResults">Show Detailed Results</label>
                            </div>
                        </form>
                        
                        <div id="evaluationResults" class="d-none mt-4">
                            <h6>Evaluation Results</h6>
                            <div class="results-container">
                                <!-- Will be populated with results -->
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" id="startEvaluation">Start Evaluation</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-light py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>PokerSim</h5>
                    <p>Advanced Poker Simulation Framework</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p>&copy; 2025 PokerSim Project</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Initialize learning curve chart
        const ctx = document.getElementById('learningCurveChart').getContext('2d');
        const learningCurveChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Loss',
                    data: [],
                    borderColor: 'rgba(75, 192, 192, 1)',
                    tension: 0.1,
                    fill: false
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
        
        // Show/hide workers input based on distributed checkbox
        document.getElementById('distributed').addEventListener('change', function() {
            document.getElementById('workersGroup').style.display = this.checked ? 'block' : 'none';
        });
        
        // Training form submission handler
        document.getElementById('trainingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get form values
            const algorithm = document.getElementById('algorithm').value;
            const iterations = parseInt(document.getElementById('iterations').value);
            const batchSize = parseInt(document.getElementById('batchSize').value);
            const learningRate = parseFloat(document.getElementById('learningRate').value);
            const useGPU = document.getElementById('useGPU').checked;
            const distributed = document.getElementById('distributed').checked;
            const numWorkers = parseInt(document.getElementById('numWorkers').value);
            
            // Update UI to show training is in progress
            document.getElementById('trainingStatus').className = 'alert alert-info';
            document.getElementById('trainingStatus').textContent = `Training ${algorithm.toUpperCase()} - Preparing...`;
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('progressPercent').textContent = '0%';
            
            // Show training stats section
            document.getElementById('trainingStats').classList.remove('d-none');
            
            // Mock data for demo purposes - in a real implementation this would come from the server
            document.getElementById('stat-algorithm').textContent = algorithm.toUpperCase();
            document.getElementById('stat-framework').textContent = useGPU ? 'PyTorch with GPU' : 'PyTorch on CPU';
            document.getElementById('stat-device').textContent = useGPU ? 'NVIDIA GPU' : 'CPU';
            document.getElementById('stat-workers').textContent = distributed ? numWorkers : 1;
            
            // Reset chart data
            learningCurveChart.data.labels = [];
            learningCurveChart.data.datasets[0].data = [];
            learningCurveChart.update();
            
            // Mock training progress - in a real implementation this would be updated from the server
            let currentIteration = 0;
            const interval = setInterval(() => {
                currentIteration += Math.floor(iterations / 20);
                if (currentIteration >= iterations) {
                    currentIteration = iterations;
                    clearInterval(interval);
                    
                    document.getElementById('trainingStatus').className = 'alert alert-success';
                    document.getElementById('trainingStatus').textContent = `Training ${algorithm.toUpperCase()} completed successfully!`;
                }
                
                const progress = Math.floor((currentIteration / iterations) * 100);
                document.getElementById('progressBar').style.width = `${progress}%`;
                document.getElementById('progressPercent').textContent = `${progress}%`;
                
                // Update stats
                document.getElementById('stat-iteration').textContent = `${currentIteration} / ${iterations}`;
                document.getElementById('stat-loss').textContent = (Math.random() * 0.1 + 0.2).toFixed(4);
                document.getElementById('stat-time').textContent = `${Math.floor(currentIteration / 20)} minutes`;
                document.getElementById('stat-memory').textContent = `${Math.floor(Math.random() * 2 + 1.5)}GB / 8GB`;
                
                // Update chart
                learningCurveChart.data.labels.push(currentIteration);
                learningCurveChart.data.datasets[0].data.push(0.3 - 0.2 * (currentIteration / iterations) + Math.random() * 0.05);
                learningCurveChart.update();
                
            }, 1000);
        });
        
        // Model list mock data - would be fetched from the server in a real implementation
        const mockModels = [
            {
                name: 'deep_cfr_model_20250414',
                algorithm: 'Deep CFR',
                framework: 'PyTorch',
                iterations: 5000,
                date: '2025-04-14'
            },
            {
                name: 'ppo_model_20250410',
                algorithm: 'PPO',
                framework: 'TensorFlow',
                iterations: 10000,
                date: '2025-04-10'
            },
            {
                name: 'nfsp_model_20250405',
                algorithm: 'NFSP',
                framework: 'PyTorch',
                iterations: 8000,
                date: '2025-04-05'
            }
        ];
        
        // Function to populate the models table
        function populateModelsTable() {
            const tableBody = document.getElementById('modelsTableBody');
            const noModelsMessage = document.getElementById('noModelsMessage');
            
            if (mockModels.length === 0) {
                tableBody.innerHTML = '';
                noModelsMessage.style.display = 'block';
                return;
            }
            
            noModelsMessage.style.display = 'none';
            
            let html = '';
            mockModels.forEach(model => {
                html += `
                    <tr>
                        <td>${model.name}</td>
                        <td>${model.algorithm}</td>
                        <td>${model.framework}</td>
                        <td>${model.iterations}</td>
                        <td>${model.date}</td>
                        <td>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-sm btn-outline-primary evaluate-btn" data-bs-toggle="modal" data-bs-target="#evaluateModal" data-model="${model.name}">Evaluate</button>
                                <button type="button" class="btn btn-sm btn-outline-secondary">Download</button>
                                <button type="button" class="btn btn-sm btn-outline-danger">Delete</button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
            
            // Add event listeners to evaluate buttons
            document.querySelectorAll('.evaluate-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const modelName = this.getAttribute('data-model');
                    document.querySelector('#evaluateModal .modal-title').textContent = `Evaluate Model: ${modelName}`;
                });
            });
        }
        
        // Initialize the models table
        populateModelsTable();
        
        // Refresh models button
        document.getElementById('refreshModels').addEventListener('click', populateModelsTable);
        
        // Evaluation form handling
        document.getElementById('startEvaluation').addEventListener('click', function() {
            const opponent = document.getElementById('evalOpponent').value;
            const numGames = document.getElementById('evalGames').value;
            const detailed = document.getElementById('detailedResults').checked;
            
            // Show loading spinner
            document.querySelector('#evaluationResults .results-container').innerHTML = `
                <div class="d-flex justify-content-center my-4">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            `;
            document.getElementById('evaluationResults').classList.remove('d-none');
            
            // Simulate evaluation (in a real implementation, this would be an API call)
            setTimeout(() => {
                // Simulate results
                const winRate = (Math.random() * 30 + 60).toFixed(2);  // 60-90% win rate
                const bbPerHand = (Math.random() * 5 + 2).toFixed(2);  // 2-7 BB/100
                
                let resultsHTML = `
                    <div class="alert alert-primary">
                        <h5>Performance Summary</h5>
                        <p>Win Rate: ${winRate}%</p>
                        <p>BB/100 Hands: ${bbPerHand}</p>
                        <p>Games Played: ${numGames}</p>
                        <p>Opponent Type: ${opponent}</p>
                    </div>
                `;
                
                if (detailed) {
                    resultsHTML += `
                        <div class="mt-3">
                            <h6>Detailed Statistics</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <canvas id="actionDistributionChart" height="200"></canvas>
                                </div>
                                <div class="col-md-6">
                                    <canvas id="positionWinRateChart" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                document.querySelector('#evaluationResults .results-container').innerHTML = resultsHTML;
                
                if (detailed) {
                    // Create action distribution chart
                    const actionCtx = document.getElementById('actionDistributionChart').getContext('2d');
                    new Chart(actionCtx, {
                        type: 'pie',
                        data: {
                            labels: ['Fold', 'Check', 'Call', 'Bet', 'Raise'],
                            datasets: [{
                                data: [20, 30, 25, 15, 10],
                                backgroundColor: [
                                    'rgba(255, 99, 132, 0.7)',
                                    'rgba(54, 162, 235, 0.7)',
                                    'rgba(255, 206, 86, 0.7)',
                                    'rgba(75, 192, 192, 0.7)',
                                    'rgba(153, 102, 255, 0.7)'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Action Distribution'
                                }
                            }
                        }
                    });
                    
                    // Create position win rate chart
                    const positionCtx = document.getElementById('positionWinRateChart').getContext('2d');
                    new Chart(positionCtx, {
                        type: 'bar',
                        data: {
                            labels: ['Early', 'Middle', 'Late', 'Button', 'SB', 'BB'],
                            datasets: [{
                                label: 'Win Rate by Position (%)',
                                data: [
                                    (Math.random() * 20 + 40).toFixed(1),
                                    (Math.random() * 20 + 45).toFixed(1),
                                    (Math.random() * 20 + 50).toFixed(1),
                                    (Math.random() * 20 + 60).toFixed(1),
                                    (Math.random() * 20 + 55).toFixed(1),
                                    (Math.random() * 20 + 50).toFixed(1)
                                ],
                                backgroundColor: 'rgba(75, 192, 192, 0.7)'
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Win Rate by Position'
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 100
                                }
                            }
                        }
                    });
                }
                
            }, 2000);  // Simulate delay
        });
    </script>
</body>
</html>